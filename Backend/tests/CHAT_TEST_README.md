# Chat API 测试页面使用说明

## 概述

`chat_test.html` 是一个简单的 Web 测试页面，用于测试 Chat API 接口的功能，包括：
- 文字消息发送
- 单张/多张图片上传
- 流式响应（SSE）支持
- 对话历史管理

## 使用方法

### 1. 启动后端服务

```bash
cd Backend
python main.py
```

确保服务运行在 `http://localhost:8000`

### 2. 打开测试页面

直接在浏览器中打开 `Backend/tests/chat_test.html` 文件，或使用本地服务器：

```bash
# Python 3
python -m http.server 8080

# 然后访问
http://localhost:8080/tests/chat_test.html
```

### 3. 配置

页面默认配置：
- **API 地址**: `http://localhost:8000`
- **Token**: `alice123` (alice 账号)
- **流式响应**: 已启用

可以根据需要修改这些配置。

## 功能说明

### 文字消息

1. 在文本框中输入消息
2. 点击"发送"按钮或按 `Enter` 键（Shift+Enter 换行）
3. 查看回复

### 图片上传

1. 点击"选择图片"按钮
2. 选择一个或多个图片文件（支持多选）
3. 选中的图片会显示在文件列表中
4. 可以点击 × 移除某个图片
5. 输入消息（可选）后点击"发送"

### 流式响应

- **启用流式响应**：可以看到回复逐字生成的效果
- **禁用流式响应**：等待完整回复后一次性显示

### 对话历史

- 页面会自动维护 `session_id`，实现多轮对话
- 点击"清除对话"可以清除当前会话的历史

## 测试场景

### 场景 1：纯文字对话

```
输入: "你好"
预期: Agent 友好回复（意图: chat）
```

### 场景 2：创建日程

```
输入: "下周三下午2点开会"
预期: 创建日程，返回事件详情（意图: create_event）
```

### 场景 3：单张图片

```
1. 选择一张图片（如 event1.png）
2. 输入: "帮我添加到日程"
预期: 从图片中提取日程信息并创建（意图: create_event）
```

### 场景 4：多张图片

```
1. 选择多张图片（event1.png, event2.jpg, event3.jpg）
2. 输入: "分析这些海报"
预期: 批量解析所有图片，创建多个日程（意图: create_event）
```

### 场景 5：修改日程

```
第一轮: "下周三下午2点开会"
第二轮: "改成下午3点"
预期: 修改刚才创建的日程（意图: update_event）
```

### 场景 6：流式响应

```
1. 启用"流式响应"选项
2. 发送消息
预期: 可以看到回复逐字生成，有打字效果
```

## 界面说明

### 消息类型

- **用户消息**：蓝色背景，右对齐
- **助手回复**：浅蓝色背景，左对齐
- **系统消息**：黄色背景（操作结果）
- **错误消息**：红色背景

### 状态栏

页面底部显示当前状态：
- "发送中..."
- "意图: create_event"
- "完成"
- "错误: ..."

## 注意事项

1. **CORS**: 如果遇到 CORS 错误，确保后端已配置 CORS 允许所有来源
2. **文件大小**: 建议每张图片不超过 5MB
3. **文件数量**: 建议一次不超过 10 张图片
4. **网络**: 确保浏览器可以访问后端 API 地址

## 故障排除

### 问题：无法连接 API

- 检查后端服务是否运行
- 检查 API 地址是否正确
- 检查浏览器控制台的错误信息

### 问题：图片上传失败

- 检查图片格式是否支持（jpg, png, gif 等）
- 检查图片大小是否过大
- 检查网络连接

### 问题：流式响应不工作

- 检查是否启用了"流式响应"选项
- 检查浏览器是否支持 SSE
- 查看浏览器控制台的错误信息

## 技术栈

- **HTML5**: 页面结构
- **Tailwind CSS**: 样式框架（CDN）
- **Vanilla JavaScript**: 无依赖的纯 JS 实现
- **Fetch API**: HTTP 请求
- **Server-Sent Events**: 流式响应

## 设计原则

遵循 ui-ux-pro-max 设计指南：
- ✅ 简洁专业的界面
- ✅ 清晰的视觉层次
- ✅ 良好的交互反馈
- ✅ 响应式设计
- ✅ 无障碍访问支持
